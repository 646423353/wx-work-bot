# 企业微信消息监控助手 - 项目功能文档

## 1. 项目概述

企业微信消息监控助手是一款专为企业设计的智能消息管理工具，通过接入企业微信，实现对群聊消息的实时监控、智能预警和数据分析。

### 1.1 核心功能

- **实时监控**：实时监测群聊消息，确保客户咨询不被遗漏
- **智能预警**：对未及时回复的消息进行智能提醒
- **数据统计**：生成详细的服务数据报表
- **群聊管理**：灵活配置群聊监控规则
- **敏感词检测**：识别和过滤敏感内容
- **多端通知**：通过企业微信、邮件等多渠道发送通知

### 1.2 技术架构

- **前端**：Vue 3 + Element Plus + Tailwind CSS + Vite
- **后端**：Node.js + Express + SQLite
- **企业微信集成**：@wecom/crypto 加密库
- **认证系统**：JWT 令牌认证

## 2. 快速开始

### 2.1 环境要求

- Node.js 16.0+ 版本
- npm 7.0+ 版本
- 企业微信企业账号

### 2.2 安装部署

1. **克隆项目**
   ```bash
   git clone <项目地址>
   cd wx-work-bot
   ```

2. **安装依赖**
   ```bash
   # 安装后端依赖
   npm install
   
   # 安装前端依赖
   cd frontend
   npm install
   cd ..
   ```

3. **配置企业微信**
   - 复制 `.env.example` 文件为 `.env`
   - 填写企业微信相关配置：
     ```
     # 企业微信配置
     CORP_ID=your_corp_id
     CORP_SECRET=your_corp_secret
     AGENT_ID=your_agent_id
     ENCODING_AES_KEY=your_encoding_aes_key
     TOKEN=your_token
     
     # 回调URL配置（需要替换为你的公网地址）
     WEBHOOK_URL=http://your-domain.com/api/webhook
     ```

4. **启动服务**
   ```bash
   # 启动后端服务
   npm start
   
   # 启动前端开发服务（新终端）
   cd frontend
   npm run dev
   ```

5. **访问系统**
   - 前端地址：http://localhost:3002
   - 后端API：http://localhost:3000/api

### 2.3 首次登录

- **默认账号**：admin
- **默认密码**：admin123
- 首次登录后请及时修改密码

## 3. 功能模块详解

### 3.1 仪表盘（Dashboard）

**功能说明**：实时展示监控概览数据，包括监控中的群聊数量、今日消息总数、未回复消息数和平均响应时间。

**核心数据**：
- 监控群聊数：当前处于监控状态的群聊数量
- 今日消息数：当天收到的消息总数
- 未回复消息：超过设定时间未回复的消息数量
- 平均响应时间：已回复消息的平均处理时间

**使用场景**：
- 客服主管日常工作的首要查看页面
- 快速了解服务整体状态
- 发现异常情况及时干预

### 3.2 群聊管理（Groups）

**功能说明**：管理需要监控的企业微信群聊，支持添加、编辑、删除群聊配置。

**操作功能**：
- **添加群聊**：输入群聊名称、成员数量和监控状态
- **编辑群聊**：修改现有群聊的配置信息
- **删除群聊**：移除不需要监控的群聊
- **状态管理**：启用或暂停群聊监控

**配置项**：
- 群聊名称：群聊的显示名称
- 成员数量：群聊中的成员人数
- 监控状态：选择「监控中」或「已暂停」

**使用场景**：
- 新群聊创建后及时添加到监控系统
- 根据业务需求调整群聊监控状态
- 定期清理不再需要监控的群聊

### 3.3 告警配置（Alerts）

**功能说明**：配置消息监控的告警规则和通知方式。

**配置项**：
- 告警启用状态：是否开启告警功能
- 超时时间：消息未回复的超时阈值（分钟）
- 通知方式：企业微信、邮件、短信等

**使用场景**：
- 根据不同群聊的重要程度设置不同的告警规则
- 为VIP客户群聊设置更严格的响应时间
- 调整通知方式确保告警及时送达

### 3.4 数据报表（Reports）

**功能说明**：生成详细的服务数据报表，支持按时间范围查询。

**报表内容**：
- 消息总量统计：总消息数、已回复消息数、未回复消息数
- 群聊统计：各群聊的消息处理情况
- 响应率分析：消息回复率和响应时间分布
- 导出功能：支持导出Excel格式报表

**使用场景**：
- 月度、季度服务质量评估
- 团队绩效数据分析
- 服务流程优化依据

### 3.5 系统设置（Settings）

**功能说明**：配置系统基础参数和用户管理。

**配置项**：
- 系统名称：自定义系统显示名称
- 刷新间隔：数据自动刷新的时间间隔
- 通知设置：通知的发送方式和频率
- 主题设置：系统界面主题切换

**使用场景**：
- 根据企业品牌定制系统显示
- 调整刷新频率平衡性能和实时性
- 管理系统用户权限

## 4. 企业微信集成

### 4.1 回调配置

1. **登录企业微信管理后台**
   - 进入「应用管理」→「自建」→ 选择应用
   - 点击「修改」进入应用详情页

2. **设置回调URL**
   - 在「接收消息服务器配置」中填写：
     ```
     URL: http://your-domain.com/api/webhook
     Token: 与.env文件中TOKEN一致
     EncodingAESKey: 与.env文件中ENCODING_AES_KEY一致
     ```

3. **验证配置**
   - 点击「保存」按钮，系统会自动验证回调地址
   - 验证通过后，企业微信会向该地址推送消息

### 4.2 消息处理流程

1. **消息接收**：企业微信将群聊消息推送到回调地址
2. **消息解密**：系统使用EncodingAESKey解密消息内容
3. **消息存储**：将消息保存到数据库
4. **监控分析**：分析消息是否需要回复
5. **告警触发**：超过设定时间未回复时触发告警
6. **通知发送**：通过配置的渠道发送通知

## 5. 常见问题

### 5.1 回调地址验证失败

**原因分析**：
- 服务器未启动或端口未开放
- 企业微信IP被防火墙屏蔽
- Token或EncodingAESKey配置错误
- 回调接口实现有问题

**解决方案**：
- 确保服务器正常运行并可访问
- 检查防火墙设置，允许企业微信IP访问
- 核对配置文件中的Token和EncodingAESKey
- 查看服务器日志，分析具体错误原因

### 5.2 消息监控不及时

**原因分析**：
- 网络延迟导致消息推送延迟
- 服务器处理速度慢
- 系统负载过高

**解决方案**：
- 检查网络连接状态
- 优化服务器性能
- 合理配置监控群聊数量

### 5.3 告警通知未收到

**原因分析**：
- 通知配置错误
- 企业微信应用权限不足
- 网络问题导致通知发送失败

**解决方案**：
- 检查通知配置是否正确
- 确保企业微信应用有发送消息的权限
- 测试通知发送功能

## 6. 系统维护

### 6.1 数据备份

建议定期备份数据库文件：
```bash
# 备份数据库
cp data/wxwork.db data/wxwork_$(date +%Y%m%d).db
```

### 6.2 日志管理

系统运行日志会输出到控制台，建议配置日志持久化：
```bash
# 启动服务并保存日志
npm start > logs/server_$(date +%Y%m%d).log 2>&1
```

### 6.3 性能优化

- **前端优化**：启用Vite构建优化，减少静态资源大小
- **后端优化**：合理设置SQLite缓存，优化数据库查询
- **网络优化**：使用CDN加速静态资源加载

## 7. 安全注意事项

1. **敏感信息保护**
   - 不要将.env文件提交到版本控制
   - 定期更换Token和EncodingAESKey
   - 使用HTTPS协议保护数据传输

2. **权限管理**
   - 严格控制系统管理员账号
   - 定期检查和更新用户密码
   - 限制API接口的访问权限

3. **数据安全**
   - 定期备份数据库
   - 加密存储敏感数据
   - 限制数据库文件的访问权限

## 8. 版本更新

### 8.1 版本历史

| 版本 | 日期 | 主要变更 |
|------|------|----------|
| v1.0 | 2026-01-28 | 初始版本发布 |

### 8.2 更新指南

1. **备份数据**：更新前请备份数据库和配置文件
2. **拉取代码**：git pull 最新代码
3. **更新依赖**：重新安装依赖包
4. **重启服务**：重启前后端服务

## 9. 技术支持

### 9.1 联系信息

- **技术支持**：<support@example.com>
- **文档中心**：<https://docs.example.com>
- **GitHub**：<https://github.com/example/wx-work-bot>

### 9.2 故障排查

1. **检查服务状态**：确保前后端服务正常运行
2. **查看日志**：分析服务器日志中的错误信息
3. **网络诊断**：检查网络连接和防火墙设置
4. **配置验证**：核对企业微信配置是否正确

## 10. 附录

### 10.1 配置参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| PORT | 服务器端口 | 3000 |
| NODE_ENV | 运行环境 | production |
| CORP_ID | 企业微信企业ID | - |
| CORP_SECRET | 企业微信应用密钥 | - |
| AGENT_ID | 企业微信应用ID | - |
| ENCODING_AES_KEY | 消息加密密钥 | - |
| TOKEN | 消息校验Token | - |
| WEBHOOK_URL | 回调地址 | - |
| JWT_SECRET | JWT认证密钥 | - |

### 10.2 API接口列表

| 接口 | 方法 | 功能描述 |
|------|------|----------|
| /api/health | GET | 健康检查 |
| /api/monitoring/overview | GET | 获取监控概览 |
| /api/groups | GET | 获取群聊列表 |
| /api/groups | POST | 添加群聊 |
| /api/groups/:id | PUT | 更新群聊 |
| /api/groups/:id | DELETE | 删除群聊 |
| /api/alerts | GET | 获取告警配置 |
| /api/alerts/:id | PUT | 更新告警配置 |
| /api/sensitive-words | GET | 获取敏感词列表 |
| /api/sensitive-words | POST | 添加敏感词 |
| /api/sensitive-words/:id | DELETE | 删除敏感词 |
| /api/reports | GET | 获取报表数据 |
| /api/reports/export | GET | 导出报表 |
| /api/auth/login | POST | 用户登录 |
| /api/auth/logout | POST | 用户登出 |
| /api/settings | GET | 获取系统设置 |
| /api/settings | PUT | 更新系统设置 |
| /api/webhook | GET | 企业微信验证 |
| /api/webhook | POST | 接收企业微信消息 |

### 10.3 数据库结构

**主要表结构**：
- **groups**：群聊信息表
- **messages**：消息记录表
- **alerts**：告警信息表
- **sensitive_words**：敏感词表
- **users**：用户信息表
- **notifications**：通知记录表

## 11. 总结

企业微信消息监控助手是一款功能强大、易于部署的智能消息管理工具，通过实时监控、智能预警和数据分析，帮助企业提升客户服务质量和团队协作效率。

**核心优势**：
- 开箱即用：简单配置即可快速部署
- 功能全面：覆盖从监控到分析的全流程
- 智能高效：自动化处理，减少人工干预
- 数据驱动：提供详细的数据分析报表
- 安全可靠：企业级安全保障

通过本工具的使用，企业可以建立更加规范、高效的客户服务体系，提升客户满意度和品牌形象，为业务发展提供有力支持。
